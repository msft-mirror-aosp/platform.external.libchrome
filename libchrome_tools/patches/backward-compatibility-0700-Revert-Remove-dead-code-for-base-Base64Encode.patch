From f7d398ba7073a98bf950ac549ac096f7537c29c5 Mon Sep 17 00:00:00 2001
From: Brett Brotherton <bbrotherton@google.com>
Date: Fri, 2 Feb 2024 08:11:26 -0700
Subject: [PATCH] Revert "Remove dead code for base::Base64Encode()."

This reverts commit d61dcfa61cdd44a5918acfbcce13ce15836cee72.
---
 base/base64.cc          | 4 ++++
 base/base64.h           | 5 +++++
 base/base64_unittest.cc | 5 +++--
 3 files changed, 12 insertions(+), 2 deletions(-)

diff --git a/base/base64.cc b/base/base64.cc
index c333fd95a6..e7afd31800 100644
--- a/base/base64.cc
+++ b/base/base64.cc
@@ -46,6 +46,10 @@ void Base64EncodeAppend(span<const uint8_t> input, std::string* output) {
   CHECK_EQ(output->size(), prefix_len + output_size);
 }
 
+void Base64Encode(StringPiece input, std::string* output) {
+  *output = Base64Encode(base::as_byte_span(input));
+}
+
 std::string Base64Encode(StringPiece input) {
   return Base64Encode(base::as_byte_span(input));
 }
diff --git a/base/base64.h b/base/base64.h
index 6c35e66571..65d52e6bab 100644
--- a/base/base64.h
+++ b/base/base64.h
@@ -24,6 +24,11 @@ BASE_EXPORT std::string Base64Encode(span<const uint8_t> input);
 BASE_EXPORT void Base64EncodeAppend(span<const uint8_t> input,
                                     std::string* output);
 
+// Encodes the input string in base64.
+// DEPRECATED, use `std::string Base64Encode(StringPiece input)` instead.
+// TODO(crbug.com/1486214): Remove this.
+BASE_EXPORT void Base64Encode(StringPiece input, std::string* output);
+
 // Encodes the input string in base64.
 BASE_EXPORT std::string Base64Encode(StringPiece input);
 
diff --git a/base/base64_unittest.cc b/base/base64_unittest.cc
index b8705e620b..727780f8af 100644
--- a/base/base64_unittest.cc
+++ b/base/base64_unittest.cc
@@ -101,8 +101,9 @@ TEST(Base64Test, Binary) {
 
   // Check that encoding the same data through the StringPiece interface gives
   // the same results.
-  std::string string_piece_encoded = Base64Encode(
-      StringPiece(reinterpret_cast<const char*>(kData), sizeof(kData)));
+  std::string string_piece_encoded;
+  Base64Encode(StringPiece(reinterpret_cast<const char*>(kData), sizeof(kData)),
+               &string_piece_encoded);
 
   EXPECT_EQ(binary_encoded, string_piece_encoded);
 
-- 
2.43.0.594.gd9cf4e227d-goog

