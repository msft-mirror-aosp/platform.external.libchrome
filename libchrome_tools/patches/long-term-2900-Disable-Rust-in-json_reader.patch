From 7b267465bf32844fb9a8552b5c155e605a352946 Mon Sep 17 00:00:00 2001
From: Andrew Moylan <amoylan@google.com>
Date: Tue, 12 Nov 2024 12:01:52 +1100
Subject: [PATCH] Disable Rust in json_reader

Change-Id: I6883925e7216b967ee3830d087792bc6fa25034f
---
 base/json/json_reader.cc | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/base/json/json_reader.cc b/base/json/json_reader.cc
index b3db0dea0f..9fe9d0b4a0 100644
--- a/base/json/json_reader.cc
+++ b/base/json/json_reader.cc
@@ -13,7 +13,7 @@
 #include "base/metrics/histogram_macros.h"
 #include "build/build_config.h"
 
-#if !BUILDFLAG(IS_NACL)
+#if !BUILDFLAG(IS_NACL) && 0
 #include "base/strings/string_view_rust.h"
 #include "third_party/rust/serde_json_lenient/v0_2/wrapper/functions.h"
 #include "third_party/rust/serde_json_lenient/v0_2/wrapper/lib.rs.h"
@@ -23,7 +23,7 @@ namespace base {
 
 // TODO(crbug.com/40811643): Move the C++ parser into components/nacl to just
 // run in-process there. Don't compile base::JSONReader on NaCL at all.
-#if !BUILDFLAG(IS_NACL)
+#if !BUILDFLAG(IS_NACL) && 0
 
 namespace {
 using serde_json_lenient::ContextPointer;
@@ -140,7 +140,7 @@ JSONReader::Result DecodeJSONInRust(std::string_view json,
 std::optional<Value> JSONReader::Read(std::string_view json,
                                       int options,
                                       size_t max_depth) {
-#if BUILDFLAG(IS_NACL)
+#if BUILDFLAG(IS_NACL) || 1
   internal::JSONParser parser(options, max_depth);
   return parser.Parse(json);
 #else   // BUILDFLAG(IS_NACL)
@@ -173,7 +173,7 @@ std::optional<Value::Dict> JSONReader::ReadDict(std::string_view json,
 JSONReader::Result JSONReader::ReadAndReturnValueWithError(
     std::string_view json,
     int options) {
-#if BUILDFLAG(IS_NACL)
+#if BUILDFLAG(IS_NACL) || 1
   internal::JSONParser parser(options);
   auto value = parser.Parse(json);
   if (!value) {
@@ -213,7 +213,7 @@ bool JSONReader::UsingRust() {
   if (!base::FeatureList::GetInstance()) {
     return false;
   }
-#if BUILDFLAG(IS_NACL)
+#if BUILDFLAG(IS_NACL) || 1
   return false;
 #else
   return base::FeatureList::IsEnabled(base::features::kUseRustJsonParser);
-- 
2.47.0.277.g8800431eea-goog

