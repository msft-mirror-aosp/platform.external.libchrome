From 4821e4df8ecdabaff46c2951a23b08f3b38190ce Mon Sep 17 00:00:00 2001
From: Byron Lee <byronlee@google.com>
Date: Tue, 26 Dec 2023 06:48:05 +0000
Subject: [PATCH] Add base::Crc32 deprecated method

Add the deprecated method for backward compatibility.

Change-Id: Ib39d0cf763ebe33fda3859744a97d3e510183341
---
 base/metrics/crc32.cc | 8 ++++++++
 base/metrics/crc32.h  | 3 +++
 2 files changed, 11 insertions(+)

diff --git a/base/metrics/crc32.cc b/base/metrics/crc32.cc
index e273d16db8..95c02675e4 100644
--- a/base/metrics/crc32.cc
+++ b/base/metrics/crc32.cc
@@ -77,4 +77,12 @@ uint32_t Crc32(uint32_t sum, span<const uint8_t> data) {
   return sum;
 }
 
+uint32_t Crc32(uint32_t sum, const void* data, size_t size) {
+  const unsigned char* bytes = reinterpret_cast<const unsigned char*>(data);
+  for (size_t i = 0; i < size; ++i) {
+    sum = kCrcTable[(sum & 0x000000FF) ^ bytes[i]] ^ (sum >> 8);
+  }
+  return sum;
+}
+
 }  // namespace base
diff --git a/base/metrics/crc32.h b/base/metrics/crc32.h
index 55fcb526c5..36423bcb06 100644
--- a/base/metrics/crc32.h
+++ b/base/metrics/crc32.h
@@ -20,6 +20,9 @@ BASE_EXPORT extern const uint32_t kCrcTable[256];
 // with any seed or be used to continue an operation began with previous data.
 BASE_EXPORT uint32_t Crc32(uint32_t sum, span<const uint8_t> data);
 
+// DEPRECATED. For backward compatibility only.
+BASE_EXPORT uint32_t Crc32(uint32_t sum, const void* data, size_t size);
+
 }  // namespace base
 
 #endif  // BASE_METRICS_CRC32_H_
-- 
2.43.0.472.g3155946c3a-goog

