# This file will be used by emerge in libchrome-XXXX.ebuild to determine the
# order of applying patches.
#
# Support selectively applying patch by use flag, examples:
# * To apply foo.patch to every board, add
#   `foo.patch`
# * To apply foo.patch to board bar only, add
#   `foo.patch board_use_bar`
# * To apply foo.patch to board installing package baz only, add
#   `foo.patch board_use_baz`
# Note: add flag to IUSE in libchrome ebuild if it is not already there.
#
# For cherry-picks, start the patch name with 'cherry-pick-r<revision number>'.
# Once uprev-ed to a version after that of the patch, all leading comments (and
# empty line, if any) will be removed together with  the patch.

# ========= LONG TERM PATCHES =========================
Add-libchrome-specific-build-configs.patch

# ICU dependency was introduced for Explode implementation to tackle Y2038
# problem but it signigicantly increases binary size. Removed as Y2038 boards
# will be EOL by then.
Remove-ICU-dependency-for-base-Time-Explode.patch

# Disable custom memory allocator when asan is used.
disable-allocator-sanitizer.patch

# Refer to crbug/1093642 on upstream or abandon these two patches.
# Add MockObjectManager, which is removed upstream.
add-mock-object-manager.patch

# Solve name conflict with abseil in absl package, when a program in Chromium
# OS depends on both abseil and libchrome.
absl-thread-annotation-conflict.patch

# Diagnostic code for upsteram to investigate crbug/1001171.
# We don't need.
revert-crbug-1001171.patch

# libchrome does not support boringssl.
keep-hash-sha1-old-implementation.patch
Do-not-use-boringssl-in-base-UnguessableToken.patch

# TODO(b/190018559): third_party/lss/linux_syscall_support.h is not provided at
# current libchrome tree.
Call-getrandom-from-sys-random.h.patch

# To avoid redefinition error when client packages uses real perfetto
add-libchrome-namespace-to-trace_event-stub-perfetto.sh

# Revert of r921558
# When malloc of more than (or close to) max size is called, it should return
# nullptr (and handled by caller) instead of crashing as the original patch
# will do.
Revert-base-allocator-Support-max-alloc-size-with-us.patch

# Avoid reintroduction of the deprecated base::Value APIs
disable-base-Dictionary-List-Value.patch

# Libchrome prefer to have consistent include headers across debug or
# non-debug, since release builders have a lot delay. That may cuase our client
# program unable to discover compilation failure at CQ/postsubmit.
always-include-platform-thread-h.patch

# Not supported in libchrome
Disable-CityHash.patch

# Revert of r980844 (crrev.com/c/3508824) since base::VerifyPathControlledByUser
# is used in CrOS.
Revert-Make-base-VerifyPathControlledByUser-Mac-only.patch

# TODO(b/229799189): Remove once performance problems with spaced in chrome
# are fixed.
libchrome-Query-spaced-for-free-total-disk-space.patch

# Add base::TerminateBecauseOutOfMemory (moved to base::partition_alloc:: in
# r1007458 (crrev.com/c/3635217)) to avoid building PA.
Add-TerminateBecauseOutOfMemory-back-to-base.patch

# Revert of r1024559 (crrev.com/c/3763511).
# Fails to build on arm and amd. Check with upstream to see if they plan to
# support them in near future. Alternatively libchrome might add new IUSE build
# flags to select source files.
Revert-Reland-Initial-implementation-of-ChromeOS-X86-stack-walker.patch

# Causes build error in floss when it defines an enum entry with the same name
# as a macro defined in netdb.h, which is indirectly included via libevent.h
# TODO(b/253138188): upstream if possible.
remove-include-third_party-libevent-event.h.patch

# ==================== CHERRY PICKS ===========================

# ==================== BACKWARD COMPATIBILITY PATCHES FOR UPREVS =========
# Backward compatibility for r890000 uprev
# Adds base::Callback, base::Bind, etc as there are still many usages in CrOS
# TODO(crbug.com/1205291): remove when they are all migrated to Once/Repeating
# variants
backward-compatibility-add-deprecated-base-Bind-APIs.patch

# Backward compatibility patch to temporarily add base::AdaptCallbackForRepeating
# TODO(b/204383858): Remove the patch when usage in mri_package is removed
backward-compatibility-add-base-AdaptCallbackForRepaeting.patch media_perception

# Backward compatibility patch to add base::bits::Align{Down,Up} that take
# size_t for both size and alignment. They are changed in r1023727
# (crrev.com/c/3752744) to be templated and take the two arguments that are of
# the same type, which causes failure in type deduction on usages that provide
# them in different type (and converted to size_t).
# TODO(b/248960258): remove when all usages changed to have correct input
# types.
backward-compatibility-Add-base-bits-Align-Down-Up-that-takes-size_t.patch

# ==================== FORWARD COMPATIBILITY PATCHES FOR UPREVS ==========
